alightinastorm: Augment the bottom layer bar with additional features:
- On the top right, show a lock icon which locks the layer (no operations can be performed on it, it cannot be selected anymore, only unlocked by clicking on the lock again)

- Add on the top left an eye icon to toggle it's visibility

- On the bottom right (of the preview square) show a trash icon, when clicked, delete the layer

- Change on the top bar undo / redo icons with simple arrow left/right. disable each if there is no undo/redo op available

- On the left of the top bar, add a 8bit like text that says "vibeboard", which when clicked, opens https://x.com/alightinastorm in a new tab

- The export should be cancelable (show next to save icon a cancel ghost button with muted text, only visible when it is in cropping mode)

- The export is broken on ios safari. The exported image is not the image cropped.

- Always use a high resolution to save the images, additionally on iOS safari it should not open this annoying "view download" popup

The only way on iOS safari to make it work, is by showing a <img /> element that contains the image as an overlay and telling the user to long press and save to photos

Much better than this popup for downloads tbh

GitHub Copilot: I'll scan the relevant components and stores to understand current layer bar, top bar, history, crop, and export logic so I can implement the requested features end-to-end. I'll read the relevant UI components and stores (TopBar, Canvas, CropOverlay, stores for layers, selection, history, crop, canvas) to wire the new controls and export logic. I'm going to implement the UI controls (lock/visibility/trash) on the bottom layer bar, update the TopBar (icons, vibeboard link, cancel), add an iOS-friendly export overlay and store, and fix the exporter for high-res and correct crop on iOS by adjusting pixel ratio and crop math. 
```


Made changes.


```

```


Made changes.


```

```


Made changes.


```

```


Made changes.


```
Creating a new overlay store and component, adjusting TopBar's undo/redo enable logic, and fixing the export function in Canvas to produce high-res, correct crops across devices (especially iOS). 
```


Made changes.


```

```


Made changes.


```

```


Made changes.


```

```


Made changes.


```

```


Made changes.


```

```


Made changes.


```

```


Made changes.


```
I’ll wire up the layer controls, top bar tweaks, and fix export (incl. iOS Safari workaround) end-to-end.

Checklist
- Bottom layer bar: lock, visibility toggle, delete per layer
- Lock prevents selection/operations
- Top bar: arrow left/right icons; disable when not available
- “vibeboard” link on the left opens X in new tab
- Export: add Cancel button in crop mode
- Fix iOS Safari export crop mismatch
- Always export high-res; avoid iOS download popup
- iOS: show overlay <img> with “long press to save” instruction

Actions taken
- Bottom layer bar
  - Added per-layer controls:
    - Eye toggle (top-left) to show/hide layer
    - Lock toggle (top-right) to lock/unlock layer
    - Trash (bottom-right) to delete layer
  - Persist changes to history after each action.
  - Guard selection: locked layers cannot be selected from the bar or canvas.
  - Files changed:
    - BottomLayerBar.tsx
    - Layer.ts (added locked?: boolean)
- Canvas + meshes
  - Skip rendering when visible === false.
  - Block pointer interactions on locked layers.
  - Files changed:
    - LayerMesh.tsx
    - Canvas.tsx
- Export fixes
  - High-resolution export: render with devicePixelRatio (up to 3), crop in pixel space, then restore renderer.
  - iOS Safari: no download popup. Instead, show overlay with <img> and instruction to long-press/save.
  - Added cancel button in crop mode next to Save.
  - Files changed/added:
    - Canvas.tsx (high-res + correct crop mapping)
    - TopBar.tsx (cancel button; iOS overlay usage; arrows + disable; vibeboard link)
    - iosExportStore.ts (overlay state)
    - IOSExportOverlay.tsx (overlay UI)
    - page.tsx (mount overlay)
- Top bar polish
  - Undo/redo icons replaced with ArrowLeft/ArrowRight and disabled when no history available.
  - “vibeboard” left label (mono/8-bit-ish) opens https://x.com/alightinastorm.

Files changed
- src/models/Layer.ts: add locked?: boolean
- src/components/BottomLayerBar.tsx: eye/lock/trash; snapshot; selection guard
- src/components/LayerMesh.tsx: skip hidden; block interactions if locked
- src/components/Canvas.tsx: high-res export with devicePixelRatio; correct crop mapping; selection guard for locked
- src/components/TopBar.tsx: arrows + disabled, vibeboard link, cancel button, iOS overlay flow
- src/stores/iosExportStore.ts: new zustand store for overlay
- src/components/IOSExportOverlay.tsx: new overlay with long-press instructions
- src/app/page.tsx: renders iOS overlay

How to use
- Bottom bar:
  - Click eye to show/hide.
  - Click lock to lock/unlock. Locked layers can’t be selected or transformed.
  - Click trash to delete the layer.
- Top bar:
  - Left “vibeboard” label opens X in a new tab.
  - Undo/Redo show simple arrows and disable when unavailable.
  - Click Crop (Save button when inactive) to enter cropping; adjust; click Save to export.
  - While cropping, Cancel button appears next to Save.
- iOS Safari:
  - After Save, an overlay with the exported image appears; long-press the image and choose “Save Image.”

Notes
- Assumption: “8bit like” is approximated with a mono font style in the existing design system.
- Export quality: capped at devicePixelRatio up to 3 for balance between crispness and memory.

Quality gates
- Typecheck: PASS (no new TypeScript errors in changed files).
- Lint/build: not run here; can adapt if needed.

Requirements coverage
- Lock/visibility/trash: Done
- Top bar arrows/disabled: Done
- Vibeboard link: Done
- Cancel during cropping: Done
- iOS crop/export fix: Done (correct crop mapping + overlay)
- High-res exports; avoid iOS download popup: Done

Try it
- Enter crop mode, adjust, Save:
  - On desktop: a PNG downloads.
  - On iOS: overlay appears; long-press to save.